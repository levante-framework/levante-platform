import{aR as f,bl as g,aS as h,bm as m}from"./index-kdKfEdeI.js";import{a6 as t}from"./tanstack-CsBZeLmk.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="51d2f44a-d624-48b0-95e7-e569c9a72164",e._sentryDebugIdIdentifier="sentry-dbid-51d2f44a-d624-48b0-95e7-e569c9a72164")}catch{}})();const y=({userIds:e=[],orgType:s,orgId:u,aggregationQuery:a,pageLimit:i,page:l,paginate:d=!0,select:n=["name"],orderBy:o,restrictToActiveUsers:p=!1})=>{const r={structuredQuery:{}};if(o&&(r.structuredQuery.orderBy=o),a||(d&&(r.structuredQuery.limit=i,r.structuredQuery.offset=l*i),r.structuredQuery.select={fields:n.map(c=>({fieldPath:c}))}),r.structuredQuery.from=[{collectionId:"users",allDescendants:!1}],r.structuredQuery.where={compositeFilter:{op:"AND",filters:[]}},p&&r.structuredQuery.where.compositeFilter.filters.push({fieldFilter:{field:{fieldPath:"archived"},op:"EQUAL",value:{booleanValue:!1}}}),e.length>0)r.structuredQuery.where.compositeFilter.filters.push({fieldFilter:{field:{fieldPath:"id"},op:"IN",value:{arrayValue:{values:[e.map(c=>({stringValue:c}))]}}}});else if(s&&u)r.structuredQuery.where.compositeFilter.filters.push({fieldFilter:{field:{fieldPath:`${s}.current`},op:"ARRAY_CONTAINS",value:{stringValue:u}}});else throw new Error("Must provide either userIds or orgType and orgId");return a?{structuredAggregationQuery:{...r,aggregations:[{alias:"count",count:{}}]}}:r},I=async(e,s,u,a,i,l=!1)=>{const d=f(),n=y({orgType:t(e),orgId:t(s),aggregationQuery:!1,pageLimit:t(u),page:t(a),paginate:!0,select:["id","username","name","email","studentData","userType","archived"],orderBy:t(i),restrictToActiveUsers:l});return console.log(`Fetching users page ${t(a)} for ${t(e)} ${t(s)}`),d.post(`${g()}:runQuery`,n).then(({data:o})=>m(o))},v=async(e,s,u,a=!1)=>{const i=f(),l=y({orgType:t(e),orgId:t(s),aggregationQuery:!0,paginate:!1,orderBy:t(u),restrictToActiveUsers:a});return i.post(`${g()}:runAggregationQuery`,l).then(({data:d})=>{var n,o;return Number(h((o=(n=d[0].result)==null?void 0:n.aggregateFields)==null?void 0:o.count))})};export{v as c,I as f};
//# sourceMappingURL=users-BXvhwqjC.js.map
