{"version":3,"file":"CreateAdministrator-DM1IuFni.js","sources":["../../src/pages/CreateAdministrator.vue"],"sourcesContent":["<template>\n  <main class=\"container main\">\n    <section class=\"main-body\">\n      <div class=\"flex flex-column\">\n        <div class=\"flex flex-column mb-5 gap-2\">\n          <div class=\"flex align-items-center flex-wrap gap-3 mb-2\">\n            <i class=\"pi pi-user-plus text-gray-400 rounded\" style=\"font-size: 1.6rem\" />\n            <div class=\"admin-page-header\">Create a new administrator account</div>\n          </div>\n          <div class=\"text-md text-gray-500 ml-6\">\n            Use this form to create a new user and give them administrator access to selected organizations.\n          </div>\n        </div>\n\n        <div v-if=\"initialized && !registering\" class=\"w-full\">\n          <div class=\"grid\">\n            <div class=\"col-12 md:col-6 lg:col-3 my-3\">\n              <PvFloatLabel>\n                <PvInputText\n                  id=\"first-name\"\n                  v-model=\"firstName\"\n                  class=\"w-full\"\n                  data-cy=\"input-administrator-first-name\"\n                />\n                <label for=\"first-name\">First Name</label>\n              </PvFloatLabel>\n            </div>\n\n            <div class=\"col-12 md:col-6 lg:col-3 my-3\">\n              <PvFloatLabel>\n                <PvInputText\n                  id=\"middle-name\"\n                  v-model=\"middleName\"\n                  class=\"w-full\"\n                  data-cy=\"input-administrator-middle-name\"\n                />\n                <label for=\"middle-name\">Middle Name</label>\n              </PvFloatLabel>\n            </div>\n\n            <div class=\"col-12 md:col-6 lg:col-3 my-3\">\n              <PvFloatLabel>\n                <PvInputText id=\"last-name\" v-model=\"lastName\" class=\"w-full\" data-cy=\"input-administrator-last-name\" />\n                <label for=\"last-name\">Last Name</label>\n              </PvFloatLabel>\n            </div>\n\n            <div class=\"col-12 md:col-6 lg:col-3 my-3\">\n              <PvFloatLabel>\n                <PvInputText id=\"email\" v-model=\"email\" class=\"w-full\" data-cy=\"input-administrator-email\" />\n                <label for=\"email\">Email</label>\n              </PvFloatLabel>\n            </div>\n          </div>\n\n          <GroupPicker @selection=\"selection($event)\" />\n          <div class=\"flex flex-row align-items-center justify-content-center gap-2 flex-order-0 my-3\">\n            <div class=\"flex flex-row align-items-center\">\n              <PvCheckbox v-model=\"isTestData\" input-id=\"chbx-externalTask\" :binary=\"true\" />\n              <label class=\"ml-1 mr-3\" for=\"chbx-externalTask\">Mark as <b>Test Administrator</b></label>\n            </div>\n          </div>\n\n          <PvDivider />\n\n          <div class=\"flex w-full align-items-center justify-content-center\">\n            <div>\n              <PvButton\n                class=\"bg-primary text-white border-none border-round p-2 h-3rem hover:bg-red-900\"\n                label=\"Create Administrator\"\n                data-cy=\"button-create-administrator\"\n                @click=\"submit\"\n              />\n            </div>\n          </div>\n        </div>\n        <div v-else class=\"loading-container\">\n          <AppSpinner style=\"margin-bottom: 1rem\" />\n          <span v-if=\"initialized\">Registering new administrator...</span>\n          <span v-else>Initializing...</span>\n        </div>\n      </div>\n    </section>\n  </main>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { storeToRefs } from 'pinia';\nimport { useToast } from 'primevue/usetoast';\nimport PvButton from 'primevue/button';\nimport PvCheckbox from 'primevue/checkbox';\nimport PvDivider from 'primevue/divider';\nimport PvInputText from 'primevue/inputtext';\nimport _cloneDeep from 'lodash/cloneDeep';\nimport _union from 'lodash/union';\nimport { useAuthStore } from '@/store/auth';\nimport GroupPicker from '@/components/GroupPicker.vue';\nimport PvFloatLabel from 'primevue/floatlabel';\nimport { TOAST_DEFAULT_LIFE_DURATION } from '@/constants/toasts';\nconst router = useRouter();\nconst toast = useToast();\nconst initialized = ref(false);\nconst registering = ref(false);\n\nconst firstName = ref();\nconst middleName = ref();\nconst lastName = ref();\nconst email = ref();\nconst isTestData = ref(false);\n\nconst authStore = useAuthStore();\nconst { roarfirekit } = storeToRefs(authStore);\n\nlet unsubscribe;\nconst init = () => {\n  if (unsubscribe) unsubscribe();\n  initialized.value = true;\n};\n\nunsubscribe = authStore.$subscribe(async (mutation, state) => {\n  if (state.roarfirekit.restConfig) init();\n});\n\nonMounted(() => {\n  if (roarfirekit.value.restConfig) init();\n});\n\nconst selectedOrgs = ref();\n\nconst selection = (selected) => {\n  selectedOrgs.value = selected;\n};\n\nconst submit = async () => {\n  const validEmail = await roarfirekit.value.isEmailAvailable(email.value);\n  if (!validEmail) {\n    toast.add({\n      severity: 'error',\n      summary: 'Error',\n      detail: `Email ${email.value} is already in use. Please enter a different email address.`,\n      life: TOAST_DEFAULT_LIFE_DURATION,\n    });\n    return;\n  }\n\n  registering.value = true;\n\n  const name = {\n    first: firstName.value,\n    middle: middleName.value,\n    last: lastName.value,\n  };\n\n  const adminOrgs = {\n    districts: selectedOrgs.value?.districts?.map((o) => o.id) ?? [],\n    schools: selectedOrgs.value?.schools?.map((o) => o.id) ?? [],\n    classes: selectedOrgs.value?.classes?.map((o) => o.id) ?? [],\n    groups: selectedOrgs.value?.groups?.map((o) => o.id) ?? [],\n    families: selectedOrgs.value?.families?.map((o) => o.id) ?? [],\n  };\n\n  // Build orgs from admin orgs. Orgs should contain all of the admin orgs. And\n  // also their parents.\n  const orgs = _cloneDeep(adminOrgs);\n\n  for (const school of selectedOrgs.value?.schools ?? []) {\n    orgs.districts = _union(orgs.districts, [school.districtId]);\n  }\n\n  for (const _class of selectedOrgs.value?.classes ?? []) {\n    orgs.districts = _union(orgs.districts, [_class.districtId]);\n    orgs.schools = _union(orgs.schools, [_class.schoolId]);\n  }\n\n  await roarfirekit.value\n    .createAdministrator(email.value, name, orgs, adminOrgs, isTestData.value)\n    .then(() => {\n      toast.add({\n        severity: 'success',\n        summary: 'Success',\n        detail: 'Administrator account created',\n        life: 5000,\n      });\n      router.push({ name: 'Home' });\n    })\n    .catch((error) => {\n      toast.add({\n        severity: 'error',\n        summary: 'Error',\n        detail: error.message,\n        life: 5000,\n      });\n      console.error(error);\n    });\n};\n</script>\n\n<style lang=\"scss\">\n.return-button {\n  display: block;\n  margin: 1rem 1.75rem;\n}\n\n.p-checkbox-box.p-highlight {\n  background-color: var(--primary-color);\n  border-color: var(--primary-color);\n  color: white;\n}\n\n#rectangle {\n  background: #fcfcfc;\n  border-radius: 0.3125rem;\n  border-style: solid;\n  border-width: 0.0625rem;\n  border-color: #e5e5e5;\n  margin: 0 1.75rem;\n  padding-top: 1.75rem;\n  padding-left: 1.875rem;\n  text-align: left;\n  overflow: hidden;\n\n  hr {\n    margin-top: 2rem;\n    margin-left: -1.875rem;\n  }\n\n  #heading {\n    font-family: 'Source Sans Pro', sans-serif;\n    font-weight: 400;\n    color: #000000;\n    font-size: 1.625rem;\n    line-height: 2.0425rem;\n  }\n\n  #section-heading {\n    font-family: 'Source Sans Pro', sans-serif;\n    font-weight: 400;\n    font-size: 1.125rem;\n    line-height: 1.5681rem;\n    color: #525252;\n  }\n\n  #administration-name {\n    height: 100%;\n    border-radius: 0.3125rem;\n    border-width: 0.0625rem;\n    border-color: #e5e5e5;\n  }\n\n  #section {\n    margin-top: 1.375rem;\n  }\n\n  #section-content {\n    font-family: 'Source Sans Pro', sans-serif;\n    font-weight: 400;\n    font-size: 0.875rem;\n    line-height: 1.22rem;\n    color: #525252;\n    margin: 0.625rem 0rem;\n  }\n\n  ::placeholder {\n    font-family: 'Source Sans Pro', sans-serif;\n    color: #c4c4c4;\n  }\n\n  .hide {\n    display: none;\n  }\n}\n</style>\n"],"names":["router","useRouter","toast","useToast","initialized","ref","registering","firstName","middleName","lastName","email","isTestData","authStore","useAuthStore","roarfirekit","storeToRefs","unsubscribe","init","mutation","state","onMounted","selectedOrgs","selection","selected","submit","TOAST_DEFAULT_LIFE_DURATION","name","adminOrgs","_b","_a","o","_d","_c","_f","_e","_h","_g","_j","_i","orgs","_cloneDeep","school","_k","_union","_class","_l","error","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_createVNode","_unref","PvFloatLabel","PvInputText","$event","_cache","_hoisted_7","_hoisted_8","_hoisted_9","GroupPicker","_hoisted_10","_hoisted_11","PvCheckbox","PvDivider","_hoisted_12","PvButton","_hoisted_13","_component_AppSpinner"],"mappings":"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"}