import{g as h,a as E,s as w,r as I,b as B,c as C}from"./survey-CRadXOqO.js";import{a as R}from"./bucket-D8HfKr8u.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="3677a2a5-530d-47d5-892f-b2291332ba2a",e._sentryDebugIdIdentifier="sentry-dbid-3677a2a5-530d-47d5-892f-b2291332ba2a")}catch{}})();async function D({surveyInstance:e,userType:a,specificSurveyData:o,userData:s,surveyStore:n,locale:t,audioLinkMap:u,generalSurveyData:c}){I({surveyInstance:e,uid:s.id,selectedAdmin:s.selectedAdminId,surveyResponsesData:s.surveyResponsesData,surveyStore:n});const l=c.pages,d=(o==null?void 0:o.pages)||[];n.setAllSurveyPages(l),n.setAllSpecificPages(d);const f=l.length,i=d.length;n.setNumberOfSurveyPages(f,i),a==="student"&&await _(e,t,u,n)}async function _(e,a,o,s){const n=h(a);await E({parsedLocale:n,setSurveyAudioLoading:s.setSurveyAudioLoading,audioLinks:o,surveyAudioBuffers:s.surveyAudioPlayerBuffers,setSurveyAudioPlayerBuffers:s.setSurveyAudioPlayerBuffers}),e.onAfterRenderPage.add((t,u)=>{const c=u.htmlElement.querySelectorAll("div[id^=sq_]");s.currentSurveyAudioSource&&s.currentSurveyAudioSource.stop(),c.forEach(l=>{const d=l,f=document.getElementById("audio-button-"+d.dataset.name);w({playAudioButton:f,el:d})})})}function G({surveyInstance:e,userType:a,roarfirekit:o,uid:s,selectedAdminId:n,surveyStore:t,router:u,toast:c,queryClient:l,userData:d,gameStore:f}){var y;let i=[];a==="parent"?i=d.childIds||[]:a==="teacher"&&(i=((y=d.classes)==null?void 0:y.current)||[]),e.onValueChanged.add((p,g)=>B({survey:p,uid:s,questionName:g.name,responseValue:g.value,userType:a,surveyStore:t,specificIds:i})),e.onCurrentPageChanged.add((p,g)=>{const m=g.oldCurrentPage;if(m){const b=m.questions,A=window.localStorage.getItem(`${R}-${s}`);if(A){const v=JSON.parse(A),P={...v.responses};b.forEach(r=>{v.responses[r.name]!==void 0&&(P[r.name]=v.responses[r.name])});const S={responses:P,pageNo:m.visibleIndex,isComplete:!1,isGeneral:!t.isGeneralSurveyComplete,specificId:t.isGeneralSurveyComplete?i[t.specificSurveyRelationIndex]:0,userType:a};try{o.saveSurveyResponses({surveyData:S,administrationId:n})}catch(r){console.error("Error saving previous page responses: ",r instanceof Error?r.message:String(r))}}}}),e.onComplete.add((p,g)=>C({sender:p,roarfirekit:o,uid:s,surveyStore:t,router:u,toast:c,queryClient:l,specificIds:i,selectedAdmin:n,userType:a,gameStore:f}))}export{G as a,D as i,_ as s};
//# sourceMappingURL=surveyInitialization-566f37hA.js.map
