{"version":3,"file":"patchWebAssembly.js","sources":["../../../src/patchWebAssembly.ts"],"sourcesContent":["import { registerModule } from './registry';\n\n/**\n * Patches the web assembly runtime.\n */\nexport function patchWebAssembly(): void {\n  if ('instantiateStreaming' in WebAssembly) {\n    const origInstantiateStreaming = WebAssembly.instantiateStreaming;\n    WebAssembly.instantiateStreaming = function instantiateStreaming(\n      response: Response | PromiseLike<Response>,\n      importObject: WebAssembly.Imports,\n    ): Promise<WebAssembly.Module> {\n      return Promise.resolve(response).then(response => {\n        return origInstantiateStreaming(response, importObject).then(rv => {\n          if (response.url) {\n            registerModule(rv.module, response.url);\n          }\n          return rv;\n        });\n      });\n    } as typeof WebAssembly.instantiateStreaming;\n  }\n\n  if ('compileStreaming' in WebAssembly) {\n    const origCompileStreaming = WebAssembly.compileStreaming;\n    WebAssembly.compileStreaming = function compileStreaming(\n      source: Response | Promise<Response>,\n    ): Promise<WebAssembly.Module> {\n      return Promise.resolve(source).then(response => {\n        return origCompileStreaming(response).then(module => {\n          if (response.url) {\n            registerModule(module, response.url);\n          }\n          return module;\n        });\n      });\n    } as typeof WebAssembly.compileStreaming;\n  }\n}\n"],"names":[],"mappings":";;AAEA;AACA;AACA;AACO,SAAS,gBAAgB,GAAS;AACzC,EAAE,IAAI,sBAAuB,IAAG,WAAW,EAAE;AAC7C,IAAI,MAAM,wBAAA,GAA2B,WAAW,CAAC,oBAAoB,CAAA;AACrE,IAAI,WAAW,CAAC,oBAAqB,GAAE,SAAS,oBAAoB;AACpE,MAAM,QAAQ;AACd,MAAM,YAAY;AAClB,MAAmC;AACnC,MAAM,OAAO,OAAO,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,QAAA,IAAY;AACxD,QAAQ,OAAO,wBAAwB,CAAC,QAAQ,EAAE,YAAY,CAAC,CAAC,IAAI,CAAC,EAAA,IAAM;AAC3E,UAAU,IAAI,QAAQ,CAAC,GAAG,EAAE;AAC5B,YAAY,cAAc,CAAC,EAAE,CAAC,MAAM,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAA;AACnD,WAAU;AACV,UAAU,OAAO,EAAE,CAAA;AACnB,SAAS,CAAC,CAAA;AACV,OAAO,CAAC,CAAA;AACR,KAAM,EAAA;AACN,GAAE;AACF;AACA,EAAE,IAAI,kBAAmB,IAAG,WAAW,EAAE;AACzC,IAAI,MAAM,oBAAA,GAAuB,WAAW,CAAC,gBAAgB,CAAA;AAC7D,IAAI,WAAW,CAAC,gBAAiB,GAAE,SAAS,gBAAgB;AAC5D,MAAM,MAAM;AACZ,MAAmC;AACnC,MAAM,OAAO,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,QAAA,IAAY;AACtD,QAAQ,OAAO,oBAAoB,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,MAAA,IAAU;AAC7D,UAAU,IAAI,QAAQ,CAAC,GAAG,EAAE;AAC5B,YAAY,cAAc,CAAC,MAAM,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAA;AAChD,WAAU;AACV,UAAU,OAAO,MAAM,CAAA;AACvB,SAAS,CAAC,CAAA;AACV,OAAO,CAAC,CAAA;AACR,KAAM,EAAA;AACN,GAAE;AACF;;;;"}