import{_ as N}from"./chunk-C6jcZpD8.js";import{d as G,s as E,aR as v,bl as p,aK as y,aG as h,bu as A,aS as b,b6 as _,bv as P}from"./index-kdKfEdeI.js";import{a6 as k}from"./tanstack-CsBZeLmk.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="f06de1d1-e0f5-404c-945f-cc8de8472f33",e._sentryDebugIdIdentifier="sentry-dbid-f06de1d1-e0f5-404c-945f-cc8de8472f33")}catch{}})();function j(e,a){return a?e.name:e.publicName??e.name}const x=async(e,a,i=5)=>{const n=[],o=N(a,i);for(const c of o){const{data:f}=await e.post(`${p()}:batchGet`,{documents:c}),u=y(f.map(({found:l})=>{if(l)return{name:l.name,data:h(l.fields,t=>b(t))}}),void 0);n.push(...u)}return n},T=async({isSuperAdmin:e,data:a,creators:i,adminOrgs:n})=>{const o=a.map(t=>t.data).map(t=>{let r={districts:t.districts,schools:t.schools,classes:t.classes,groups:t.groups,families:t.families};return e.value||(r=P(n.value,r)),{id:t.id,name:t.name,publicName:t.publicName,dates:{start:t.dateOpened,end:t.dateClosed,created:t.dateCreated},creator:{...i[t.createdBy]},assessments:t.assessments,assignedOrgs:r,testData:t.testData??!1}}),c=a.filter(t=>t.name!==void 0).map(({name:t})=>`${t}/stats/total`),f=v(),u=await x(f,c);return o==null?void 0:o.map(t=>{const r=u.find(g=>g.name.includes(t.id));return{...t,stats:{total:r==null?void 0:r.data}}})},z=async(e,a,i=!1,n)=>{const o=G(),{roarfirekit:c}=E(o),f=await c.value.getAdministrations({testData:k(i)}),u=v(),l=f.map(s=>`${p()}/administrations/${s}`);let t=[];try{t=await u.post(`${p()}:batchGet`,{documents:l})}catch(s){return console.error("Error fetching administration data:",s),{sortedAdministrations:[],administrations:[]}}const r=y(t.data.map(({found:s})=>{if(s)return{name:s.name,data:{id:A(s.name.split("/")),...h(s.fields,d=>b(d))}}}),void 0),g=r.map(s=>s.data.createdBy).filter(Boolean),O=[...new Set(g)].map(s=>`${p()}/users/${s}`),{data:S}=await u.post(`${p()}:batchGet`,{documents:O}),$=S.reduce((s,{found:d})=>{if(d){const w=A(d.name.split("/"));s[w]={id:w,...h(d.fields,C=>b(C))}}return s},{}),D=await T({isSuperAdmin:e,data:r,creators:$,adminOrgs:a}),m=((n==null?void 0:n.value)??_)[0].field.fieldPath,I=((n==null?void 0:n.value)??_)[0].direction;return{sortedAdministrations:D.filter(s=>s[m]!==void 0).sort((s,d)=>I==="ASCENDING"?2*+(s[m]>d[m])-1:I==="DESCENDING"?2*+(d[m]>s[m])-1:0),administrations:D}},H=(e,a,i)=>!i||!e||!a?[]:i.filter(n=>{var c;return(((c=n.assignedOrgs)==null?void 0:c[a])||[]).includes(e)});export{H as a,z as b,j as g};
//# sourceMappingURL=administrations-BtjuibWP.js.map
