import{o as ve,bo as Ae,bp as Ce,F as Pe,d as ye,s as he,aF as Qe,e as Ve,i as Fe,h as Le,n as y,L as Oe,a0 as P,f as Ue,bf as oe}from"./index-kdKfEdeI.js";import{u as $e,_ as ie}from"./useDistrictSchoolsQuery-CjmrtD9R.js";import{s as le,_ as Be,a as ne}from"./RoarDataTable-3RAt9d4s.js";import{s as de}from"./index-BrLDugnL.js";import{s as je}from"./index-Cl6pdWAz.js";import{c as Me,b as Ge,a as Ye,u as qe}from"./useGroupsQuery-nr4_Vz4U.js";import{a7 as be,a6 as B,c as _,r as D,w as ue,o as ze,U as Ke,R as x,O as b,S as o,k,F as ce,N as R,W as Q,z as s,Y as We,M as He,a0 as Je,a1 as Xe,ac as Ze,_ as W}from"./tanstack-CsBZeLmk.js";import{h as et,u as tt}from"./useDistrictsQuery-CeEXa47D.js";import{S as j}from"./orgs-C8TAQ0-m.js";import{a as st}from"./assignments-orZosl8K.js";import{u as rt,s as pe,a as me}from"./useTasksDictionaryQuery-DDq5c2TB.js";import{u as at}from"./useUserDataQuery-kceEoCbw.js";import{t as z,g as ot}from"./reports-DZCyTjfn.js";import{g as fe}from"./administrations-BtjuibWP.js";import{l as it}from"./lodash-DAY8-RAI.js";import{s as ge}from"./index-D6IoMtKH.js";import"./phoneme-MNW3QAs-.js";import"./sentry-CX5z418I.js";import"./_createCompounder-BtP0Easx.js";import"./index-ai9ELtVp.js";import"./index-BOUM9DJf.js";import"./index-DBlP99Qc.js";import"./index-D4pzgRTJ.js";import"./index-SnZVGOaT.js";import"./index-DXN1oPWm.js";import"./index-d6wokVQG.js";import"./index-CmbHKKL9.js";import"./index-Ca817Vow.js";import"./toInteger-CM0MbwkG.js";import"./toNumber-iH9M7_fM.js";import"./_baseEach-Ab1i50PF.js";import"./forEach-Bss9sJkU.js";import"./_arrayEach-FC5DT91E.js";import"./startCase-CKAWOUbs.js";import"./upperFirst-CKgMld1W.js";import"./index-WdjxwDDE.js";import"./lowerCase-Cjz_C50J.js";import"./tasks-DtSsBL6W.js";import"./useTasksQuery-DLa8TwAo.js";import"./utils-DSob1QZ1.js";import"./chunk-C6jcZpD8.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},u=new n.Error().stack;u&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[u]="963c3ae6-bfee-4845-bcc8-c5cfb6ef863a",n._sentryDebugIdIdentifier="sentry-dbid-963c3ae6-bfee-4845-bcc8-c5cfb6ef863a")}catch{}})();const lt=(n,u)=>{const c=[()=>et(n)],{isQueryEnabled:E,options:i}=ve(c,u);return be({queryKey:[Ce,n],queryFn:()=>{var p;return Ae((p=B(n))==null?void 0:p.map(w=>({collection:Pe.ADMINISTRATIONS,docId:`${w}/stats/total`})))},enabled:E,...i})};function nt(n,u,c=void 0){return c={enabled:!0,...c},_(()=>{switch(n){case j.DISTRICTS:return tt(u,c);case j.SCHOOLS:return Ye(u,c);case j.CLASSES:return Ge(u,c);case j.GROUPS:return Me(u,c);default:throw new Error(`Unsupported org type: ${n}`)}}).value}const dt=(n,u,c,E)=>{const i=ye(),{roarUid:p}=he(i),w=[()=>!!B(n),()=>!!B(u),()=>!!B(c),()=>!!B(p)],{isQueryEnabled:A,options:M}=ve(w,E);return be({queryKey:[Qe,n,`${u}-${c}`],queryFn:()=>st(n,u,c,!0),enabled:A,...M})},ut=(n,u)=>{if(typeof n!="string")throw new Error("Route must be a string");if(!u||typeof u!="object")throw new Error("Mapping must be an object");return`/${n.split("/").filter(p=>p!=="").map(p=>{if(p.startsWith(":")){const w=p.slice(1),A=u[w];return A!==void 0?String(A):`:${w}`}return p}).join("/")}`},ct={class:"container main"},pt={class:"main-body"},mt={key:0,class:"loading-wrapper"},ft={class:"flex justify-content-between align-items-center"},gt={class:"flex flex-column align-items-start mb-4 gap-2"},vt={class:"uppercase font-light text-gray-500 text-md"},yt={class:"report-title uppercase"},ht={class:"administration-name uppercase"},bt={class:"administration-creator"},xt={key:0,class:"flex flex-row align-items-center gap-4"},St={key:0},_t={key:0,class:"flex flex-column align-items-around flex-wrap gap-3 rounded bg-gray-100 p-2 details-card"},wt={class:"flex flex-column gap-1 mx-5 mb-5"},Tt={class:"text-lg font-bold text-gray-600 w-full"},Nt={class:"flex flex-column mx-5"},Dt={class:"flex justify-content-between align-items-center"},kt={class:"text-xl font-bold text-gray-600 w-full"},Et={class:"font-light text-sm"},It={class:"flex flex-column align-items-center mx-5"},Rt={key:0,class:"font-light uppercase text-xs text-gray-500 my-1"},At={key:0},Ct={key:0,class:"flex flex-row gap-2"},Pt={class:"flex flex-row gap-2"},Ss={__name:"ProgressReport",props:{administrationId:{type:String,required:!0},orgType:{type:String,required:!0},orgId:{type:String,required:!0}},setup(n){const u=Ve(),c=ye(),{roarfirekit:E}=he(c),i=n,p=D(!1),w=_(()=>i.orgType==="district"?"Site":i.orgType==="group"?"Cohort":i.orgType),A=_(()=>te.value||J.value),M=D({name:"Progress Report",constant:!0}),xe=[{name:"Progress Report",constant:!0},{name:"Score Report",constant:!1}],Se=_(()=>T.value?fe(T.value,X.value):""),_e=()=>{const{administrationId:t,orgType:e,orgId:a}=i;u.push({path:ut(Ue.SCORE_REPORT,{administrationId:t,orgType:e,orgId:a})})},H=D([{order:"1",field:"user.grade"},{order:"1",field:"user.lastName"}]);i.orgType==="district"&&H.value.unshift({order:"1",field:"user.schoolName"});const G=D([]),Y=D([]),we=D(10),{data:q,isLoading:J}=rt({enabled:p}),{data:Te}=Le({enabled:p}),{isSuperAdmin:X}=Fe(Te),{data:T}=qe([i.administrationId],{enabled:p,select:t=>t[0]}),Z=_(()=>{var t;return(t=T==null?void 0:T.value)==null?void 0:t.createdBy}),{data:Ne}=at(Z,{enabled:_(()=>!!Z.value)}),{data:C}=lt([i.administrationId],{enabled:p,select:t=>t[0]}),{data:V}=$e(i.orgId,{enabled:i.orgType===j.DISTRICTS&&p}),{data:ee}=nt(i.orgType,[i.orgId],{enabled:p,select:t=>t[0]}),{isLoading:te,isFetching:De,data:F}=dt(i.administrationId,i.orgType,i.orgId,{enabled:p}),ke=_(()=>V.value?V.value.reduce((t,e)=>(t[e.id]=e.name,t),{}):{}),L=_(()=>{var e,a,d,m,f;if(!F.value)return[];const t=[];for(const{assignment:v,user:l,survey:g}of F.value){let r="";const S=(e=l==null?void 0:l.schools)==null?void 0:e.current[0];S&&(r=ke.value[S]);const I={user:{username:(l==null?void 0:l.username)||((a=v==null?void 0:v.userData)==null?void 0:a.username)||"",userType:l.userType,userId:l.userId,firstName:((d=l==null?void 0:l.name)==null?void 0:d.first)||"",lastName:((m=l==null?void 0:l.name)==null?void 0:m.last)||"",grade:(f=l.studentData)==null?void 0:f.grade,assessmentPid:l.assessmentPid,schoolName:r}},N={};for(const h of v.assessments){let U="";const $=h.taskId;h!=null&&h.optional?(N[$]={value:"optional",icon:"pi pi-question",severity:"info"},U+=" Optional "):(h==null?void 0:h.completedOn)!==void 0?(N[$]={value:"completed",icon:"pi pi-check-circle",severity:"success"},U+=" Completed "):(h==null?void 0:h.startedOn)!==void 0?(N[$]={value:"started",icon:"pi pi-clock",severity:"warn"},U+=" Started "):(N[$]={value:"not started",icon:"pi pi-minus-circle",severity:"warning"},U+=" Not Started "),N[$].tags=U}I.progress=N,t.push(I)}return t}),Ee=()=>{G.value=[],Y.value=[]},Ie=t=>{const e=ne(t,({user:a,progress:d})=>{var f;let m={Email:y(a,"email"),First:y(a,"firstName"),Last:y(a,"lastName"),Grade:y(a,"grade")};c.isUserSuperAdmin&&(m.PID=y(a,"assessmentPid")),i.orgType==="district"&&(m.School=y(a,"schoolName"));for(const v in d)m[((f=q.value[v])==null?void 0:f.publicName)??v]=d[v].value;return m});oe(e,"roar-progress-selected.csv")},Re=async()=>{const t=ne(L.value,({user:e,progress:a})=>{var m;let d={Email:y(e,"email"),First:y(e,"firstName"),Last:y(e,"lastName"),Grade:y(e,"grade")};c.isUserSuperAdmin&&(d.PID=y(e,"assessmentPid")),i.orgType==="district"&&(d.School=y(e,"schoolName"));for(const f in a)d[((m=q.value[f])==null?void 0:m.publicName)??f]=a[f].value;return d});oe(t,`roar-progress-${ie(fe(T.value,X.value))}-${ie(ee.value.name)}.csv`)},se=_(()=>{var v,l,g;if(J.value||F.value===void 0)return[];const t=[];if([{field:"user.email",header:"Email",pinned:!0}].forEach(({field:r,header:S,pinned:I})=>{const N=r.split(".");F.value.find(h=>y(h,N))&&t.push({field:r,header:S,dataType:"text",sort:!0,filter:!0,...I&&{pinned:!0}})}),t.push({field:"user.username",header:"Username",dataType:"text",sort:!0,filter:!0}),i.orgType==="district"){const r=(v=V.value)==null?void 0:v.reduce((S,I)=>(S[I.id]=I.name,S),{});t.push({field:"user.schoolName",header:"School",dataType:"text",sort:!0,filter:!1,schoolsMap:r})}const a=(l=T.value.assessments)==null?void 0:l.map(r=>r.taskId),d=a==null?void 0:a.sort((r,S)=>Object.keys(z).includes(r)&&Object.keys(z).includes(S)?z[r].order-z[S].order:-1),m=["swr","sre","pa"],f=[];for(const r of m)d.includes(r)&&f.push(r);for(const r of d)m.includes(r)||f.push(r);for(const r of f)t.push({field:`progress.${r}.value`,filterField:`progress.${r}.tags`,header:((g=q.value[r])==null?void 0:g.name)??r,dataType:"progress",tag:!0,severityField:`progress.${r}.severity`,iconField:`progress.${r}.icon`,sort:!0});return t}),O=D(L.value);ue(L,t=>{O.value=t}),ue([G,Y],([t,e])=>{if(t.length>0||e.length>0){let a=L.value;t.length>0&&(a=a.filter(d=>t.includes(d.user.schoolName))),e.length>0&&(a=a.filter(d=>e.includes(d.user.grade))),O.value=a}else O.value=L.value});let K;const re=D(!1),ae=()=>{re.value=!0,K&&K(),re.value=!1,p.value=!0};return K=c.$subscribe(async(t,e)=>{e.roarfirekit.restConfig&&ae()}),ze(async()=>{E.value.restConfig&&ae()}),(t,e)=>{var d,m,f,v,l;const a=Ke("tooltip");return b(),x("main",ct,[o("section",pt,[A.value?(b(),x("div",mt,[k(Oe,{fullscreen:""}),e[3]||(e[3]=o("div",{class:"uppercase text-sm text-gray-600 font-light"},"Loading Progress Datatable",-1))])):(b(),x(ce,{key:1},[o("div",ft,[o("div",gt,[o("div",null,[o("div",vt,Q(w.value)+" Progress Report",1),o("div",yt,Q((d=s(ee))==null?void 0:d.name),1)]),o("div",null,[e[4]||(e[4]=o("div",{class:"uppercase font-light text-gray-500 text-md"},"Assignment",-1)),o("div",ht,Q(Se.value),1)]),o("div",null,[e[5]||(e[5]=o("div",{class:"uppercase font-light text-gray-500 text-md"},"Created by",-1)),o("div",bt,Q((m=s(Ne))==null?void 0:m.displayName),1)])]),s(P)?R("",!0):(b(),x("div",xt,[e[6]||(e[6]=o("div",{class:"uppercase text-sm text-gray-600"},"VIEW",-1)),We(k(s(je),{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=g=>M.value=g),options:xe,"option-disabled":"constant","allow-empty":!1,"option-label":"name",class:"flex my-2 select-button",onChange:_e},null,8,["modelValue"]),[[a,"View different report",void 0,{top:!0}]])]))]),(f=s(F))!=null&&f.length?(b(),x("div",St,[s(it.isEmpty)(s(C))?R("",!0):(b(),x("div",_t,[o("div",wt,[e[7]||(e[7]=o("div",{class:"text-sm uppercase text-gray-500"},"Progress by Task",-1)),(b(!0),x(ce,null,Je(s(T).assessments,({taskId:g})=>{var r;return b(),x("div",{key:g,class:"flex justify-content-between align-items-center"},[o("div",Tt,Q(((r=s(q)[g])==null?void 0:r.name)||g),1),k(s(de),{type:"bar",data:s(me)(s(C)[g]),options:s(pe)(s(C)[g]),class:"h-2rem lg:w-full"},null,8,["data","options"])])}),128))]),o("div",Nt,[e[9]||(e[9]=o("div",{class:"text-sm uppercase text-gray-500"},"Total Progress",-1)),o("div",Dt,[o("div",kt,[e[8]||(e[8]=Xe(" Total ",-1)),o("span",Et," (Assigned to "+Q(s(C).assignment.assigned)+" users) ",1)]),k(s(de),{type:"bar",data:s(me)(s(C).assignment),options:s(pe)(s(C).assignment),class:"h-3rem lg:w-full"},null,8,["data","options"])])]),o("div",It,[e[10]||(e[10]=Ze('<div class="flex flex-wrap justify-content-around align-items-center px-2 py-1 rounded"><div class="legend-entry"><div class="circle" style="background-color:var(--bright-green);"></div><div><div>Completed</div></div></div><div class="legend-entry"><div class="circle" style="background-color:var(--yellow-100);"></div><div><div>Started</div></div></div><div class="legend-entry"><div class="circle" style="background-color:var(--surface-d);"></div><div><div>Not Started</div></div></div></div>',1)),s(P)?R("",!0):(b(),x("div",Rt,"Legend"))])])),((v=se.value)==null?void 0:v.length)??!1?(b(),He(Be,{key:1,data:O.value,columns:se.value,"total-records":(l=O.value)==null?void 0:l.length,loading:s(te)||s(De),"page-limit":we.value,"data-cy":"roar-data-table","allow-filtering":!s(P),"reset-filters":Ee,"allow-export":!s(P),"allow-column-selection":!s(P),"lazy-pre-sorting":H.value,"show-options-control":!1,onExportSelected:Ie,onExportAll:Re},{filterbar:W(()=>[s(P)?R("",!0):(b(),x("div",At,[s(V)?(b(),x("div",Ct,[k(s(ge),null,{default:W(()=>[k(s(le),{id:"ms-school-filter",modelValue:G.value,"onUpdate:modelValue":e[1]||(e[1]=g=>G.value=g),style:{width:"20rem","max-width":"25rem"},options:s(V),"option-label":"name","option-value":"name","show-toggle-all":!1,"selected-items-label":"{0} schools selected","data-cy":"filter-by-school"},null,8,["modelValue","options"]),e[11]||(e[11]=o("label",{for:"ms-school-filter"},"Filter by School",-1))]),_:1,__:[11]})])):R("",!0),o("div",Pt,[k(s(ge),null,{default:W(()=>[k(s(le),{id:"ms-grade-filter",modelValue:Y.value,"onUpdate:modelValue":e[2]||(e[2]=g=>Y.value=g),style:{width:"20rem","max-width":"25rem"},options:s(ot),"option-label":"label","option-value":"value","show-toggle-all":!1,"selected-items-label":"{0} grades selected","data-cy":"filter-by-grade"},null,8,["modelValue","options"]),e[12]||(e[12]=o("label",{for:"ms-school-filter"},"Filter by Grade",-1))]),_:1,__:[12]})])]))]),_:1},8,["data","columns","total-records","loading","page-limit","allow-filtering","allow-export","allow-column-selection","lazy-pre-sorting"])):R("",!0)])):R("",!0)],64))])])}}};export{Ss as default};
//# sourceMappingURL=ProgressReport-DkkXbFCv.js.map
