graph TD
  subgraph Dashboard[levante-dashboard]
    UI_Admins[Admin UI]
    UI_Users[User UI]
    UI_Orgs[Org UI]
    UI_AdminsAssign[Assignment UI]
    UI_Participant[Participant UI]
    UI_Tasks[Task/Variant UI]
  end

  subgraph Functions[levante-firebase-functions]
    FN_CreateUsers[createUsers]
    FN_EditUsers[editUsers]
    FN_LinkUsers[linkUsers]
    FN_UpsertOrg[upsertOrg]
    FN_DeleteOrg[deleteOrgFunction]
    FN_UpsertAdmin[upsertAdministration]
    FN_DeleteAdmin[deleteAdministration]
    FN_GetAdmins[getAdministrations]
    FN_StartTask[startTask]
    FN_CompleteTask[completeTask]
    FN_SaveSurvey[saveSurveyResponses]
    TRG_Assignments[syncAssignmentsOnAdministrationUpdate]
    TRG_UserSync[syncAssignmentsOnUserUpdate]
    TRG_RunSync[syncOnRunDocUpdate]
  end

  subgraph Firestore[Firestore Collections]
    USERS[users]
    ADMINISTRATIONS[administrations]
    ASSIGNMENTS[users/*/assignments]
    RUNS[users/*/runs]
    TRIALS[users/*/runs/*/trials]
    ORGS[districts/schools/classes/groups]
    TASKS[tasks]
    VARIANTS[tasks/*/variants]
    SURVEYS[users/*/surveyResponses]
    USERCLAIMS[userClaims]
  end

  UI_Users -->|writes| FN_CreateUsers
  UI_Users -->|writes| FN_EditUsers
  UI_Users -->|writes| FN_LinkUsers
  UI_Users -->|reads| USERS

  UI_Orgs -->|writes| FN_UpsertOrg
  UI_Orgs -->|writes| FN_DeleteOrg
  UI_Orgs -->|reads| ORGS

  UI_AdminsAssign -->|writes| FN_UpsertAdmin
  UI_AdminsAssign -->|writes| FN_DeleteAdmin
  UI_AdminsAssign -->|reads| ADMINISTRATIONS
  UI_AdminsAssign -->|reads| ORGS

  UI_Admins -->|reads| USERS
  UI_Admins -->|reads| USERCLAIMS

  UI_Participant -->|writes| FN_StartTask
  UI_Participant -->|writes| FN_CompleteTask
  UI_Participant -->|writes| FN_SaveSurvey
  UI_Participant -->|reads| ASSIGNMENTS
  UI_Participant -->|reads| RUNS

  UI_Tasks -->|reads| TASKS
  UI_Tasks -->|reads| VARIANTS

  FN_CreateUsers --> USERS
  FN_EditUsers --> USERS
  FN_LinkUsers --> USERS
  FN_UpsertOrg --> ORGS
  FN_DeleteOrg --> ORGS
  FN_UpsertAdmin --> ADMINISTRATIONS
  FN_DeleteAdmin --> ADMINISTRATIONS
  FN_GetAdmins --> ADMINISTRATIONS
  FN_StartTask --> RUNS
  FN_StartTask --> ASSIGNMENTS
  FN_CompleteTask --> RUNS
  FN_CompleteTask --> ASSIGNMENTS
  FN_SaveSurvey --> SURVEYS

  ADMINISTRATIONS --> TRG_Assignments
  USERS --> TRG_UserSync
  RUNS --> TRG_RunSync

  TRG_Assignments --> ASSIGNMENTS
  TRG_UserSync --> ASSIGNMENTS
  TRG_RunSync --> ASSIGNMENTS
