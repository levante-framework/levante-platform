Object.defineProperty(exports, '__esModule', { value: true });

const registry = require('./registry.js');

/**
 * Patches the web assembly runtime.
 */
function patchWebAssembly() {
  if ('instantiateStreaming' in WebAssembly) {
    const origInstantiateStreaming = WebAssembly.instantiateStreaming;
    WebAssembly.instantiateStreaming = function instantiateStreaming(
      response,
      importObject,
    ) {
      return Promise.resolve(response).then(response => {
        return origInstantiateStreaming(response, importObject).then(rv => {
          if (response.url) {
            registry.registerModule(rv.module, response.url);
          }
          return rv;
        });
      });
    } ;
  }

  if ('compileStreaming' in WebAssembly) {
    const origCompileStreaming = WebAssembly.compileStreaming;
    WebAssembly.compileStreaming = function compileStreaming(
      source,
    ) {
      return Promise.resolve(source).then(response => {
        return origCompileStreaming(response).then(module => {
          if (response.url) {
            registry.registerModule(module, response.url);
          }
          return module;
        });
      });
    } ;
  }
}

exports.patchWebAssembly = patchWebAssembly;
//# sourceMappingURL=patchWebAssembly.js.map
