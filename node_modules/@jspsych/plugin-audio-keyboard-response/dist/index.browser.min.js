var jsPsychAudioKeyboardResponse=function(e){"use strict";function t(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(n=a.key,r=void 0,"symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(n,"string"))?r:String(r)),a)}var n,r}var i={name:"audio-keyboard-response",parameters:{stimulus:{type:e.ParameterType.AUDIO,pretty_name:"Stimulus",default:void 0},choices:{type:e.ParameterType.KEYS,pretty_name:"Choices",default:"ALL_KEYS"},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration",default:null},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},trial_ends_after_audio:{type:e.ParameterType.BOOL,pretty_name:"Trial ends after audio",default:!1},response_allowed_while_playing:{type:e.ParameterType.BOOL,pretty_name:"Response allowed while playing",default:!0}}},a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=t}var i,a,n;return i=e,a=[{key:"trial",value:function(e,t,i){var a,n,r=this,s=this.jsPsych.pluginAPI.audioContext(),o={rt:null,key:null};this.jsPsych.pluginAPI.getAudioBuffer(t.stimulus).then((function(e){null!==s?(r.audio=s.createBufferSource(),r.audio.buffer=e,r.audio.connect(s.destination)):(r.audio=e,r.audio.currentTime=0),l()})).catch((function(e){console.error('Failed to load audio file "'.concat(t.stimulus,'". Try checking the file path. We recommend using the preload plugin to load audio files.')),console.error(e)}));var l=function(){t.trial_ends_after_audio&&r.audio.addEventListener("ended",u),null!==t.prompt&&(e.innerHTML=t.prompt),null!==s?(n=s.currentTime,r.audio.start(n)):r.audio.play(),t.response_allowed_while_playing?c():t.trial_ends_after_audio||r.audio.addEventListener("ended",c),null!==t.trial_duration&&r.jsPsych.pluginAPI.setTimeout((function(){u()}),t.trial_duration),i()},u=function i(){r.jsPsych.pluginAPI.clearAllTimeouts(),null!==s?r.audio.stop():r.audio.pause(),r.audio.removeEventListener("ended",i),r.audio.removeEventListener("ended",c),r.jsPsych.pluginAPI.cancelAllKeyboardResponses();var n={rt:o.rt,stimulus:t.stimulus,response:o.key};e.innerHTML="",r.jsPsych.finishTrial(n),a()};function d(e){null==o.key&&(o=e),t.response_ends_trial&&u()}var c=function(){null!==s?r.jsPsych.pluginAPI.getKeyboardResponse({callback_function:d,valid_responses:t.choices,rt_method:"audio",persist:!1,allow_held_key:!1,audio_context:s,audio_context_start_time:n}):r.jsPsych.pluginAPI.getKeyboardResponse({callback_function:d,valid_responses:t.choices,rt_method:"performance",persist:!1,allow_held_key:!1})};return new Promise((function(e){a=e}))}},{key:"simulate",value:function(e,t,i,a){"data-only"==t&&(a(),this.simulate_data_only(e,i)),"visual"==t&&this.simulate_visual(e,i,a)}},{key:"simulate_data_only",value:function(e,t){var i=this.create_simulation_data(e,t);this.jsPsych.finishTrial(i)}},{key:"simulate_visual",value:function(e,t,i){var a=this,n=this.create_simulation_data(e,t),r=this.jsPsych.getDisplayElement(),s=function(){null!==n.rt&&a.jsPsych.pluginAPI.pressKey(n.response,n.rt)};this.trial(r,e,(function(){i(),e.response_allowed_while_playing?s():a.audio.addEventListener("ended",s)}))}},{key:"create_simulation_data",value:function(e,t){var i={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),response:this.jsPsych.pluginAPI.getValidKey(e.choices)},a=this.jsPsych.pluginAPI.mergeSimulationData(i,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,a),a}}],a&&t(i.prototype,a),n&&t(i,n),Object.defineProperty(i,"prototype",{writable:!1}),e}();return a.info=i,a}(jsPsychModule);
//# sourceMappingURL=https://unpkg.com/@jspsych/plugin-audio-keyboard-response@1.1.3/dist/index.browser.min.js.map
