{"version":3,"file":"index.js","sources":["../../src/index.js"],"sourcesContent":["const favicons = require('favicons');\nconst fs = require('fs');\nconst path = require('path');\n\nconst callback = (error, response) => new Promise((resolve, reject) => {\n  if (error) {\n    reject(error);\n  }\n  resolve(response);\n});\n\nconst writeFile = (filePath, fileContent) => new Promise((resolve, reject) => {\n  fs.writeFile(filePath, fileContent, (writeFileError) => {\n    if (writeFileError) {\n      reject(writeFileError);\n    }\n    resolve(filePath);\n  });\n});\n\nconst getURLPath = (base, assetDir) => {\n  let publicUrl = path.join(base, assetDir);\n  try {\n    const parsedPublicUrl = new URL(publicUrl);\n    publicUrl = parsedPublicUrl.toString();\n  } catch (error) {\n    // assuming error means relative url under the package scope\n    publicUrl = publicUrl.replaceAll('\\\\', '/');\n  }\n  return publicUrl;\n};\n\nconst vitePluginFaviconsInject = (inputSource, inputConfig = {}, pluginInputConfig = {}) => {\n  let response = false;\n  let isProcessed = false;\n  let viteConfig = false;\n  let source = inputSource;\n  let config = inputConfig;\n  let pluginConfig = pluginInputConfig;\n  return {\n    name: 'vite-plugin-favicon-inject',\n    configResolved(resolvedConfig) {\n      viteConfig = resolvedConfig;\n      // override default source if none set\n      if (!source || source === '') {\n        source = path.join(viteConfig.root, 'src', 'logo.png');\n      }\n      // making sure that config is a object\n      if (!config || (config && config.constructor.name !== 'Object')) {\n        config = {};\n      }\n      if (!pluginConfig || (pluginConfig && pluginConfig.constructor.name !== 'Object')) {\n        pluginConfig = {\n          failGraciously: false,\n        };\n      }\n\n      // override default path is none set\n      const opPath = getURLPath(\n        viteConfig.base,\n        viteConfig.build.assetsDir,\n      );\n      config.path = opPath;\n    },\n    transformIndexHtml(html) {\n      const flowPromise = !isProcessed\n        ? favicons.favicons(source, config, callback)\n        : new Promise((resolve) => (resolve(response)));\n      return flowPromise.then((res) => {\n        response = res;\n        isProcessed = true;\n        return html.replace('</head>', `${res.html.join('')}</head>`);\n      }).catch((err) => {\n        throw err;\n      });\n    },\n    closeBundle() {\n      const fileCreationPromise = [];\n      const { files } = response;\n      const { images } = response;\n      const originalPath = path.join(\n        viteConfig.root,\n        viteConfig.build.outDir,\n        viteConfig.build.assetsDir,\n      );\n\n      if (files) {\n        files.forEach((eachFile) => {\n          fileCreationPromise.push(writeFile(`${originalPath}/${eachFile.name}`, eachFile.contents));\n        });\n      } else if (!pluginConfig.failGraciously) {\n        throw new Error('NO_FILES_FOUND');\n      }\n\n      if (images) {\n        images.forEach((eachImage) => {\n          fileCreationPromise.push(writeFile(`${originalPath}/${eachImage.name}`, eachImage.contents));\n        });\n      } else if (!pluginConfig.failGraciously) {\n        throw new Error('NO_IMAGES_FOUND');\n      }\n      return Promise.all(fileCreationPromise);\n    },\n  };\n};\n\nexport default vitePluginFaviconsInject;\n"],"names":[],"mappings":"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"}