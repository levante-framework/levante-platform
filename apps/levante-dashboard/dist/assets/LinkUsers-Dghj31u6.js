import{m as $,d as P,z as H,k as W,bI as G,j as Q}from"./index-kdKfEdeI.js";import{s as X}from"./index-DgqMGbNZ.js";import{L as Y}from"./bucket-D8HfKr8u.js";import{M as A,O as p,_,S as e,a1 as u,z as m,r as v,R as b,k,N as F,F as j,a0 as x,W as D,t as S}from"./tanstack-CsBZeLmk.js";import{e as O,d as V}from"./index-SnZVGOaT.js";import{s as Z}from"./index-C9Tcp7BM.js";import{_ as J}from"./forEach-Bss9sJkU.js";import{_ as ee}from"./startCase-CKAWOUbs.js";import{T as w}from"./toasts-BqURhU4z.js";import"./phoneme-MNW3QAs-.js";import"./sentry-CX5z418I.js";import"./lodash-DAY8-RAI.js";import"./index-d6wokVQG.js";import"./index-CmbHKKL9.js";import"./index-DXN1oPWm.js";import"./index-DBlP99Qc.js";import"./index-BqleXkYD.js";import"./index-CsSDOoHL.js";import"./_arrayEach-FC5DT91E.js";import"./_baseEach-Ab1i50PF.js";import"./_createCompounder-BtP0Easx.js";import"./upperFirst-CKgMld1W.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},T=new h.Error().stack;T&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[T]="c98d0a24-6409-465f-ab30-7058add49576",h._sentryDebugIdIdentifier="sentry-dbid-c98d0a24-6409-465f-ab30-7058add49576")}catch{}})();const se={class:"csv-example-image-container"},re=["src"],ie={__name:"LinkUsersInfo",setup(h){return(T,t)=>(p(),A(m(X),{header:"Link Users",class:"link-users-panel"},{default:_(()=>[t[0]||(t[0]=e("div",{class:"info-message-container"},[e("i",{class:"pi pi-exclamation-circle"}),e("p",null," Make sure you are editing the downloaded file you got after adding users. This new file contains all of your information and LEVANTE UIDs. ")],-1)),t[1]||(t[1]=e("div",{class:"how-to-section"},[e("h3",null,"How to Link Users"),e("ol",{class:"numbered-steps"},[e("li",null,[e("span",{class:"step-number"},"1"),u("Fill in CSV with the user linking data from below. Users need to be linked so we can keep track of their relationships, like assigning the proper specific survey sections to caregiver and teacher users. ")]),e("li",null,[e("span",{class:"step-number"},"2"),u('Upload the file and click "Start Linking"')])])],-1)),t[2]||(t[2]=e("p",null," The following fields define the columns for your CSV file when linking users. Please refer to the legend below for specific requirements on each field. ",-1)),t[3]||(t[3]=e("ul",null,[e("li",null,[e("b",null,"id"),e("span",{class:"field-marker"},"*"),u(" - A unique identifier for the user in CSV file.")]),e("li",null,[e("b",null,"userType"),e("span",{class:"field-marker"},"*"),u(" - The type of user: child, caregiver, teacher.")]),e("li",null,[e("b",null,"caregiverId"),e("span",{class:"field-marker"},"*"),e("span",{class:"field-marker"},"†"),u(" - A unique identifier (id) for the child's caregiver. ")]),e("li",null,[e("b",null,"teacherId"),e("span",{class:"field-marker"},"*"),e("span",{class:"field-marker"},"†"),u(" - A unique identifier (id) for the child's teacher. (*only required if administering teacher survey) ")]),e("li",null,[e("b",null,"uid"),e("span",{class:"field-marker"},"*"),e("span",{class:"field-marker"},"‡"),u(" - The unique LEVANTE identifier that is returned after user is added to dashboard. ")])],-1)),t[4]||(t[4]=e("p",{class:"mb-6 legend"},[e("span",{class:"field-marker"},"*"),u(" Required for this Step"),e("br"),e("span",{class:"field-marker"},"†"),u(" Required only for child users. Leave blank for caregiver or teacher users."),e("br"),e("span",{class:"field-marker"},"‡"),u(" Created by the platform during Add Users step. ")],-1)),t[5]||(t[5]=e("p",null," Below is an example of what your CSV/spreadsheet should look like. Only the required columns will be processed. ",-1)),e("div",se,[e("img",{id:"link-users-example-image",src:m(Y)+"/link_users_example.png",alt:"Link Users CSV example",class:"csv-example-image"},null,8,re)])]),_:1,__:[0,1,2,3,4,5]}))}},ae=$(ie,[["__scopeId","data-v-ffa80fde"]]),te={class:"container main"},le={class:"main-body"},oe={key:0,class:"text-gray-500 mb-2 surface-100 border-round p-2 mt-5"},ne={key:1},de={class:"col-header"},ce={class:"submit-container"},ue={key:2,class:"error-container"},fe={__name:"LinkUsers",setup(h){const T=P(),t=H(),C=v(!1),g=v([]),y=v([]),L=v([]),U=v(!1),I=v(!1),q=[{field:"id",header:"ID",dataType:"string"},{field:"userType",header:"User Type",dataType:"string"},{field:"caregiverId",header:"Caregiver ID",dataType:"string"},{field:"teacherId",header:"Teacher ID",dataType:"string"},{field:"uid",header:"UID",dataType:"string"}],N=async a=>{I.value=!1;const i=a.files[0],s=await G(i);if(!s||s.length===0){t.add({severity:"error",summary:"Error: Empty File",detail:"The uploaded file contains no data",life:w});return}g.value=s;const l=S(g.value[0]),d=Object.keys(l).map(f=>f.toLowerCase());console.log("allColumns: ",d);const o=d.includes("id"),n=d.includes("usertype"),c=d.includes("uid"),r=[];if(o||r.push("id"),n||r.push("userType"),c||r.push("uid"),r.length>0){t.add({severity:"error",summary:"Error: Missing Column",detail:`Missing required column(s): ${r.join(", ")}`,life:w});return}M(),y.value.length===0&&(C.value=!0,t.add({severity:"success",summary:"Success",detail:"File Successfully Uploaded",life:w}))},M=()=>{y.value=[];const a=new Map(S(g.value).map(s=>[s.id.toString(),s])),i=["id","usertype","uid"];g.value.forEach(s=>{console.log("user: ",s);const l=[];i.forEach(o=>{const n=Object.keys(s).find(c=>c.toLowerCase()===o);(!n||!s[n])&&l.push(o==="usertype"?"userType":o)});const d=Object.keys(s).find(o=>o.toLowerCase()==="usertype");if(d&&s[d].toLowerCase()==="child"){const o=Object.keys(s).find(c=>c.toLowerCase()==="caregiverid");o&&s[o]&&s[o].trim()!==""&&(typeof s[o]=="string"?s[o].split(",").map(r=>r.trim()):[s[o].toString()]).forEach(r=>{if(console.log("caregiverId in loop:",r),!a.has(r))l.push(`Caregiver with ID ${r} not found`);else{const f=Object.keys(a.get(r)).find(K=>K.toLowerCase()==="usertype"),E=f?a.get(r)[f].toLowerCase():null;(!f||E!=="caregiver")&&l.push(`User with ID ${r} is not a caregiver`)}});const n=Object.keys(s).find(c=>c.toLowerCase()==="teacherid");n&&s[n]&&s[n].trim()!==""&&(typeof s[n]=="string"?s[n].split(",").map(r=>r.trim()):[s[n].toString()]).forEach(r=>{if(!a.has(r))l.push(`Teacher with ID ${r} not found`);else{const f=Object.keys(a.get(r)).find(E=>E.toLowerCase()==="usertype");(!f||a.get(r)[f].toLowerCase()!=="teacher")&&l.push(`User with ID ${r} is not a teacher`)}})}l.length>0&&B(s,`Missing Field(s): ${l.join(", ")}`)}),y.value.length>0&&(console.log("errorUsers: ",y.value),t.add({severity:"error",summary:"Missing Fields. See below for details.",life:w}))},R=async()=>{U.value=!0;try{const a=S(g.value).map(i=>{const s={},l=Object.keys(i).find(r=>r.toLowerCase()==="id"),d=Object.keys(i).find(r=>r.toLowerCase()==="usertype"),o=Object.keys(i).find(r=>r.toLowerCase()==="uid");if(l&&(s.id=i[l]),d){const r=i[d];s.userType=r.toLowerCase()==="caregiver"?"parent":r}o&&(s.uid=i[o]);const n=Object.keys(i).find(r=>r.toLowerCase()==="caregiverid"),c=Object.keys(i).find(r=>r.toLowerCase()==="teacherid");return n&&i[n]&&(s.parentId=i[n]),c&&i[c]&&(s.teacherId=i[c]),Object.keys(i).forEach(r=>{const f=r.toLowerCase();["id","usertype","uid","caregiverid","teacherid","parentid"].includes(f)||(s[r]=i[r])}),s});await T.roarfirekit.linkUsers(a),C.value=!1,t.add({severity:"success",summary:"Success",detail:"Users linked successfully",life:w})}catch(a){console.error(a),t.add({severity:"error",summary:"Error",detail:`Failed to link users: ${a.message}. Please try again.`,life:w})}finally{U.value=!1}};function z(a){let i=[];const s=Object.keys(a);return J(s,l=>{let d=typeof a[l];d==="object"&&a[l]instanceof Date&&(d="date"),i.push({field:l,header:ee(l),dataType:d})}),i}function B(a,i){Q(L.value)&&(L.value=z(a),L.value.unshift({dataType:"string",field:"error",header:"Cause of Error"}),I.value=!0),y.value.push({...a,error:i})}return(a,i)=>(p(),b("main",te,[e("section",le,[k(ae),C.value?F("",!0):(p(),b("div",oe,[k(m(Z),{name:"linkUsersUploader[]","custom-upload":"",accept:".csv",class:"bg-primary mb-2 p-3 w-2 text-white border-none border-round h-3rem m-0 hover:bg-red-900",auto:"","show-upload-button":!1,"show-cancel-button":!1,onUploader:i[0]||(i[0]=s=>N(s))},{empty:_(()=>i[1]||(i[1]=[e("div",{class:"flex justify-center items-center text-gray-500"},[e("p",null,"Click choose or drag and drop files to here to upload.")],-1)])),_:1})])),C.value&&!y.value.length?(p(),b("div",ne,[k(m(V),{ref:"dataTable",value:g.value,"show-gridlines":"","row-hover":!0,"resizable-columns":!0,paginator:"","always-show-paginator":!1,rows:10,class:"datatable"},{default:_(()=>[(p(),b(j,null,x(q,s=>k(m(O),{key:s.field,field:s.field},{header:_(()=>[e("div",de,[e("b",null,D(s.header),1)])]),_:2},1032,["field"])),64))]),_:1},8,["value"]),e("div",ce,[k(m(W),{label:U.value?"Linking Users":"Start Linking",icon:U.value?"pi pi-spin pi-spinner":"",disabled:U.value,class:"bg-primary mb-2 p-3 w-2 text-white border-none border-round h-3rem m-0 hover:bg-red-900",onClick:R},null,8,["label","icon","disabled"])])])):F("",!0),I.value?(p(),b("div",ue,[i[2]||(i[2]=e("div",{class:"error-header"},[e("h3",null,"Rows with Errors")],-1)),k(m(V),{ref:"errorTable",value:y.value,"show-gridlines":"","row-hover":!0,"resizable-columns":!0,paginator:"","always-show-paginator":!1,rows:10,class:"datatable"},{default:_(()=>[(p(!0),b(j,null,x(L.value,s=>(p(),A(m(O),{key:s.field,field:s.field},{header:_(()=>[u(D(s.header),1)]),_:2},1032,["field"]))),128))]),_:1},8,["value"])])):F("",!0)])]))}},Ve=$(fe,[["__scopeId","data-v-61583a08"]]);export{Ve as default};
//# sourceMappingURL=LinkUsers-Dghj31u6.js.map
