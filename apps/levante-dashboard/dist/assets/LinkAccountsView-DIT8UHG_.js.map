{"version":3,"file":"LinkAccountsView-DIT8UHG_.js","sources":["../../src/components/adminSettings/LinkAccountsView.vue"],"sourcesContent":["<template>\n  <h2>Link Accounts</h2>\n  <span>Make logging in easy by linking your accounts.</span>\n  <div class=\"table-container\">\n    <!-- Google -->\n    <div class=\"flex flex-row justify-content-between w-full\" style=\"background-color: var(--surface-d)\">\n      <div class=\"flex flex-row w-full h-3rem p-2 gap-2\">\n        <img src=\"../../assets/provider-google-logo.svg\" alt=\"The Google Logo\" class=\"mr-2\" />\n        <span style=\"line-height: 30px\" class=\"text-lg\">Google</span>\n        <div class=\"chip-container\">\n          <PvChip v-if=\"providerIds.includes('google.com')\" icon=\"pi pi-check\" label=\"Linked\" class=\"linked-chip\" />\n          <PvChip v-else label=\"Linked\" icon=\"pi pi-times\" class=\"unlinked-chip\" />\n        </div>\n      </div>\n      <button\n        v-if=\"providerIds.includes('google.com')\"\n        class=\"border-none border-round bg-primary text-white p-2 my-2 hover:surface-400 mr-2\"\n        @click=\"unlinkAccount('google')\"\n      >\n        Unlink\n      </button>\n      <button\n        v-else\n        class=\"border-none border-round bg-primary text-white p-2 my-2 hover:surface-400 mr-2\"\n        @click=\"linkAccount('google')\"\n      >\n        Link\n      </button>\n    </div>\n  </div>\n  <div>\n    <h2 style=\"margin-top: 3.5rem\">Delete Password</h2>\n    <span\n      >You have the option to remove your password if you want to exclusively use an SSO option listed above. You must\n      have <span class=\"font-bold\"> at least one</span> other login method linked to delete your password.</span\n    >\n    <div class=\"flex justify-content-end\">\n      <button\n        :disabled=\"!canDeletePassword\"\n        class=\"border-none border-round bg-primary text-white p-2 my-2 hover:surface-400\"\n        @click=\"deletePassword\"\n      >\n        Delete Password\n      </button>\n    </div>\n  </div>\n  <PvConfirmDialog />\n</template>\n<script setup>\nimport { ref, onMounted, computed } from 'vue';\nimport { useToast } from 'primevue/usetoast';\nimport { useConfirm } from 'primevue/useconfirm';\nimport { storeToRefs } from 'pinia';\nimport PvChip from 'primevue/chip';\nimport PvConfirmDialog from 'primevue/confirmdialog';\nimport { useAuthStore } from '@/store/auth';\n\n// +----------------+\n// | Initialization |\n// +----------------+\nconst authStore = useAuthStore();\nconst { roarfirekit } = storeToRefs(authStore);\nconst toast = useToast();\nconst providerIds = computed(() => {\n  const providerData = roarfirekit.value?.admin?.user?.providerData;\n  return providerData.map((provider) => {\n    return provider.providerId;\n  });\n});\n\n// +-------------------------+\n// | Firekit Inititalization |\n// +-------------------------+\nconst initialized = ref(false);\nlet unsubscribe;\nconst init = () => {\n  if (unsubscribe) unsubscribe();\n  initialized.value = true;\n};\n\nunsubscribe = authStore.$subscribe(async (mutation, state) => {\n  if (state.roarfirekit.restConfig) init();\n});\n\nonMounted(() => {\n  if (roarfirekit.value.restConfig) init();\n});\n\n// +-----------------------+\n// | Linking and Unlinking |\n// +-----------------------+\nconst linkAccount = async (providerId) => {\n  console.log(`Linking account with ${providerId}`);\n  await roarfirekit.value\n    .linkAuthProviderWithPopup(providerId)\n    .then(() => {\n      return roarfirekit.value.forceIdTokenRefresh();\n    })\n    .catch((error) => {\n      const errorCode = error.code;\n      if (errorCode === 'auth/provider-already-linked') {\n        // This user already has credentials for this provider\n        toast.add({\n          severity: 'error',\n          summary: 'Account already linked',\n          detail: 'This account is already associated with that provider.',\n          life: 3000,\n        });\n      } else if (errorCode === 'auth/auth/credential-already-in-use') {\n        // This credential is already linked with another account\n        toast.add({\n          severity: 'error',\n          summary: 'Email already in use',\n          detail: 'The login you provided is already associated with an existing account.',\n          life: 3000,\n        });\n      } else if (errorCode === 18) {\n        // Error code for known cross-origin popup issue. Ignore.\n        console.log('Cross-origin popup error ignored.');\n      } else {\n        // Oops! Error occured.\n        toast.add({\n          severity: 'error',\n          summary: 'Error occurred',\n          detail: 'An unexpected error occurred while linking this account.',\n          life: 3000,\n        });\n      }\n      return roarfirekit.value.forceIdTokenRefresh();\n    });\n};\nconst unlinkAccount = async (providerId) => {\n  console.log(`Unlinking account with ${providerId}`);\n  roarfirekit.value.unlinkAuthProvider(providerId);\n};\n\n// +-----------------+\n// | Delete Password |\n// +-----------------+\nconst confirm = useConfirm();\nconst canDeletePassword = computed(() => {\n  return providerIds.value.includes('password') && providerIds.value.length > 1;\n});\nconst deletePassword = async () => {\n  confirm.require({\n    message: 'Once deleted, you will need to use an SSO option to access your account!',\n    header: 'Delete Password',\n    icon: 'pi pi-exclamation-triangle',\n    rejectClass: 'p-button-secondary p-button-outlined',\n    rejectLabel: 'Cancel',\n    acceptLabel: 'Delete',\n    accept: async () => {\n      await unlinkAccount('password')\n        .then(() => {\n          toast.add({\n            severity: 'success',\n            summary: 'Password Deleted',\n            detail: 'Password authentication has been removed from your account.',\n            life: 3000,\n          });\n        })\n        .catch(() => {\n          toast.add({\n            severity: 'error',\n            summary: 'Error occurred',\n            detail: 'An unexpected error occurred while deleting your password.',\n            life: 3000,\n          });\n        });\n    },\n  });\n};\n</script>\n<style scoped>\n.table-container {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin-top: 1rem;\n  background-color: var(--surface-b);\n  border: solid 1px var(--surface-d);\n  border-radius: var(--border-radius);\n}\n.linked-chip {\n  background-color: var(--green-400);\n  color: var(--green-800);\n  border: solid 1px var(--green-800);\n  border-radius: 20px;\n  padding-left: 10px;\n  gap: 5px;\n  width: 100%;\n  height: 100%;\n}\n.unlinked-chip {\n  background-color: var(--red-400);\n  color: var(--red-800);\n  border: solid 1px var(--red-800);\n  border-radius: 20px;\n  padding-left: 10px;\n  gap: 5px;\n  width: 100%;\n  height: 100%;\n}\n.chip-container {\n  width: 100px;\n  height: 24px;\n  margin-top: auto;\n  margin-bottom: auto;\n}\n</style>\n"],"names":["authStore","useAuthStore","roarfirekit","storeToRefs","toast","useToast","providerIds","computed","_c","_b","_a","provider","initialized","ref","unsubscribe","init","mutation","state","onMounted","linkAccount","providerId","error","errorCode","unlinkAccount","confirm","useConfirm","canDeletePassword","deletePassword","_cache","_createElementVNode","_hoisted_1","_hoisted_2","_hoisted_3","_imports_0","_hoisted_4","_createBlock","_unref","PvChip","_createElementBlock","_hoisted_5","_hoisted_6","_createVNode","PvConfirmDialog"],"mappings":"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"}