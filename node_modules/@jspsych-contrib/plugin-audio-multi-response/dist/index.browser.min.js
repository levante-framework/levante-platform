var jsPsychAudioMultiResponse=function(e){"use strict";function t(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var n={name:"audio-multi-response",parameters:{stimulus:{type:e.ParameterType.HTML_STRING,pretty_name:"Stimulus",default:void 0},button_choices:{type:e.ParameterType.STRING,pretty_name:"Button Choices",default:[],array:!0},keyboard_choices:{type:e.ParameterType.KEYS,pretty_name:"Keyboard Choices",default:"NO_KEYS"},button_html:{type:e.ParameterType.HTML_STRING,pretty_name:"Button HTML",default:'<button class="jspsych-btn">%choice%</button>',array:!0},prompt:{type:e.ParameterType.HTML_STRING,pretty_name:"Prompt",default:null},prompt_above_buttons:{type:e.ParameterType.BOOL,pretty_name:"Prompt above buttons",default:!1},trial_duration:{type:e.ParameterType.INT,pretty_name:"Trial duration",default:null},margin_vertical:{type:e.ParameterType.STRING,pretty_name:"Margin vertical",default:"0px"},margin_horizontal:{type:e.ParameterType.STRING,pretty_name:"Margin horizontal",default:"8px"},response_ends_trial:{type:e.ParameterType.BOOL,pretty_name:"Response ends trial",default:!0},trial_ends_after_audio:{type:e.ParameterType.BOOL,pretty_name:"Trial ends after audio",default:!1},response_allowed_while_playing:{type:e.ParameterType.BOOL,pretty_name:"Response allowed while playing",default:!0}}},a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.jsPsych=t}var n,a,r;return n=e,a=[{key:"trial",value:function(e,t,n){var a,r,o=this,i=this.jsPsych.pluginAPI.audioContext(),s={rt:null,key:null,button:null,source:null};this.jsPsych.pluginAPI.getAudioBuffer(t.stimulus).then((function(e){null!==i?(o.audio=i.createBufferSource(),o.audio.buffer=e,o.audio.connect(i.destination)):(o.audio=e,o.audio.currentTime=0),u()})).catch((function(e){console.error('Failed to load audio file "'.concat(t.stimulus,'". Try checking the file path. We recommend using the preload plugin to load audio files.')),console.error(e)}));var u=function(){t.trial_ends_after_audio&&o.audio.addEventListener("ended",l),t.response_allowed_while_playing||t.trial_ends_after_audio||(o.audio.addEventListener("ended",h),o.audio.addEventListener("ended",p));var a=[];if(Array.isArray(t.button_html))t.button_html.length==t.button_choices.length?a=t.button_html:console.error("Error in audio-multi-response plugin. The length of the button_html array does not equal the length of the choices array");else for(var s=0;s<t.button_choices.length;s++)a.push(t.button_html);var u='<div id="jspsych-audio-multi-response-btngroup">';for(s=0;s<t.button_choices.length;s++){var c=a[s].replace(/%choice%/g,t.button_choices[s]);u+='<div class="jspsych-audio-multi-response-button" style="cursor: pointer; display: inline-block; margin:'+t.margin_vertical+" "+t.margin_horizontal+'" id="jspsych-audio-multi-response-button-'+s+'" data-choice="'+s+'">'+c+"</div>"}u+="</div>",null!==t.prompt&&(t.prompt_above_buttons?u='<div id="jspsych-audio-multi-response-prompt">'+t.prompt+"</div>"+u:u+='<div id="jspsych-audio-multi-response-prompt">'+t.prompt+"</div>"),e.innerHTML=u,t.response_allowed_while_playing?(p(),h()):d(),r=performance.now(),null!==i?(r=i.currentTime,o.audio.start(r)):o.audio.play(),null!==t.trial_duration&&o.jsPsych.pluginAPI.setTimeout((function(){l()}),t.trial_duration),n()},l=function n(){o.jsPsych.pluginAPI.clearAllTimeouts(),null!==i?o.audio.stop():o.audio.pause(),o.audio.removeEventListener("ended",n),o.audio.removeEventListener("ended",h),o.audio.removeEventListener("ended",p),o.jsPsych.pluginAPI.cancelAllKeyboardResponses();var r={rt:s.rt,stimulus:t.stimulus,keyboard_response:s.key,button_response:s.button,response_source:s.source};e.innerHTML="",o.jsPsych.finishTrial(r),a()};function c(e){!function(e){var n=performance.now(),a=Math.round(n-r);null!==i&&(n=i.currentTime,a=Math.round(1e3*(n-r))),s.button=parseInt(e),s.rt=a,s.source="button",d(),t.response_ends_trial&&l()}(e.currentTarget.getAttribute("data-choice"))}function d(){for(var e=document.querySelectorAll(".jspsych-audio-multi-response-button"),t=0;t<e.length;t++){var n=e[t].querySelector("button");n&&(n.disabled=!0),e[t].removeEventListener("click",c)}}function p(){for(var e=document.querySelectorAll(".jspsych-audio-multi-response-button"),t=0;t<e.length;t++){var n=e[t].querySelector("button");n&&(n.disabled=!1),e[t].addEventListener("click",c)}}var y=function(e){null==s.key&&(s=Object.assign({source:"keyboard",button:null},e)),t.response_ends_trial&&l()},h=function(){var e;"NO_KEYS"!=t.keyboard_choices&&(e=null!==i?{rt_method:"audio",audio_context:i,audio_context_start_time:r}:{rt_method:"performance"},o.jsPsych.pluginAPI.getKeyboardResponse(Object.assign({callback_function:y,valid_responses:t.keyboard_choices,persist:!1,allow_held_key:!1},e)))};return new Promise((function(e){a=e}))}},{key:"simulate",value:function(e,t,n,a){"data-only"==t&&(a(),this.simulate_data_only(e,n)),"visual"==t&&this.simulate_visual(e,n,a)}},{key:"create_simulation_data",value:function(e,t){var n={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),keyboard_response:this.jsPsych.pluginAPI.getValidKey(e.keyboard_choices),button_response:null,response_source:"keyboard"},a={stimulus:e.stimulus,rt:this.jsPsych.randomization.sampleExGaussian(500,50,1/150,!0),button_response:this.jsPsych.randomization.randomInt(0,e.button_choices.length-1),keyboard_response:null,response_source:"button"},r=Math.random()<.5?n:a,o=this.jsPsych.pluginAPI.mergeSimulationData(r,t);return this.jsPsych.pluginAPI.ensureSimulationDataConsistency(e,o),o}},{key:"simulate_data_only",value:function(e,t){var n=this.create_simulation_data(e,t);this.jsPsych.finishTrial(n)}},{key:"simulate_visual",value:function(e,t,n){var a=this,r=this.create_simulation_data(e,t),o=this.jsPsych.getDisplayElement(),i=function(){null!==r.rt&&(null!==r.button_response?a.jsPsych.pluginAPI.clickTarget(o.querySelector('div[data-choice="'.concat(r.response,'"] button')),r.rt):a.jsPsych.pluginAPI.pressKey(r.keyboard_response,r.rt))};this.trial(o,e,(function(){n(),e.response_allowed_while_playing?i():a.audio.addEventListener("ended",i)}))}}],a&&t(n.prototype,a),r&&t(n,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();return a.info=n,a}(jsPsychModule);
//# sourceMappingURL=index.browser.min.js.map
