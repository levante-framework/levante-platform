var y=Object.defineProperty;var I=(s,t,n)=>t in s?y(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var d=(s,t,n)=>I(s,typeof t!="symbol"?t+"":t,n);import{cF as R,cG as v,ct as E}from"./index-kdKfEdeI.js";import{g as C}from"./lodash-DAY8-RAI.js";import{b as D,L as N,a as S}from"./bucket-D8HfKr8u.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="5da716da-bf08-4b9a-85cd-87b5d23e153b",s._sentryDebugIdIdentifier="sentry-dbid-5da716da-bf08-4b9a-85cd-87b5d23e153b")}catch{}})();var x=v,L=R,O=L(function(s,t,n){x(s,t,n)}),_=O;const A=C(_);class G{constructor(t,n,e){d(this,"context");d(this,"urlListMap");d(this,"onload");d(this,"bufferList");d(this,"loadCount");this.context=t,this.urlListMap=n,this.onload=e,this.bufferList={},this.loadCount=0}loadBuffer(t,n){const e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=()=>{this.context.decodeAudioData(e.response,i=>{if(!i){console.error("error decoding file data: "+t);return}this.bufferList[n]=i,this.loadCount+=1,this.loadCount===Object.keys(this.urlListMap).length&&this.onload(this.bufferList)},i=>{console.error("decodeAudioData error",i)})},e.onerror=i=>{console.error("Request error",i)},e.send()}load(){Object.keys(this.urlListMap).forEach(t=>{this.loadBuffer(this.urlListMap[t],t)})}}const T=window.AudioContext||window.webkitAudioContext,j=new T,k=async s=>{const n=(await E.get(D)).data||{items:[]},e={};return n.items.forEach(i=>{var f,o;if(i.contentType==="audio/mpeg"&&i.name.startsWith(s)){const a=i.name.split("/"),r=a[1],c=(o=(f=a.at(-1))==null?void 0:f.split("."))==null?void 0:o[0];c&&(e[r]||(e[r]={}),e[r][c]=N+`/${i.name}`)}}),e};function J(s){var t;return((t=(s||"").split("-"))==null?void 0:t[0])||"en"}function M({bufferList:s,parsedLocale:t,setSurveyAudioLoading:n,setSurveyAudioPlayerBuffers:e}){e(t,s),n(!1)}const K=({parsedLocale:s,setSurveyAudioLoading:t,audioLinks:n,surveyAudioBuffers:e,setSurveyAudioPlayerBuffers:i})=>{if(e[s])return;t(!0),new G(j,n[s],o=>M({bufferList:o,parsedLocale:s,setSurveyAudioLoading:t,setSurveyAudioPlayerBuffers:i})).load()},q=({playAudioButton:s,el:t})=>{s&&(s.classList.add("play-button-visible"),s.style.display="flex",t.appendChild(s))};function B({surveyInstance:s,uid:t,selectedAdmin:n,surveyResponsesData:e,surveyStore:i}){const f=window.localStorage.getItem(`${S}-${t}`);if(f){const o=JSON.parse(f),a=Object.fromEntries(Object.entries(o.responses).map(([r,c])=>[r,c.responseValue]));return s.data=a,s.currentPageNo=o.pageNo,{isRestored:!0,pageNo:o.pageNo}}else if(e){const o=e.find(a=>(a==null?void 0:a.administrationId)===n);if(o){if(!i.isGeneralSurveyComplete&&o.general){const a=Object.fromEntries(Object.entries(o.general.responses).map(([r,c])=>[r,c.responseValue]));s.data=a}else if(o.specific){const a=i.specificSurveyRelationIndex,r=Object.fromEntries(Object.entries(o.specific[a].responses).map(([c,l])=>[c,l.responseValue]));s.data=r}return s.currentPageNo=o.pageNo??0,{isRestored:!0,pageNo:o.pageNo??0}}}return{isRestored:!1,pageNo:0}}function F({survey:s,uid:t,questionName:n,responseValue:e,specificIds:i,userType:f,surveyStore:o}){const a=s.currentPageNo,r=`${S}-${t}`,c=window.localStorage.getItem(r);if(c){const l=JSON.parse(c);l.pageNo=a,l.responses[n]={responseValue:e,responseTime:new Date().toISOString()},window.localStorage.setItem(r,JSON.stringify(l))}else{const l={pageNo:a,isGeneral:!0,isComplete:!1,specificId:0,responses:{},userType:f};if(!o.isGeneralSurveyComplete)l.responses[n]={responseValue:e,responseTime:new Date().toISOString()};else{const u=o.specificSurveyRelationIndex;l.specificId=i[u],l.responses[n]={responseValue:e,responseTime:new Date().toISOString()},l.isComplete=!1,l.isGeneral=!1}window.localStorage.setItem(r,JSON.stringify(l))}}async function H({sender:s,roarfirekit:t,uid:n,surveyStore:e,selectedAdmin:i,router:f,toast:o,queryClient:a,specificIds:r,userType:c,gameStore:l}){const u=window.localStorage.getItem(`${S}-${n}`);let b=[];u&&(b=JSON.parse(u).responses);const w=s.getAllQuestions(),h={};w.forEach(p=>h[p.name]=null);const g={pageNo:0,isGeneral:!0,isComplete:!0,specificId:0,responses:A({},h,b),userType:c,isEntireSurveyCompleted:!1};if(e.isGeneralSurveyComplete){g.isGeneral=!1;const p=e.specificSurveyRelationIndex;g.specificId=r[p]}let m;c==="student"?m=!0:e.specificSurveyRelationData.length>0?m=e.isGeneralSurveyComplete&&e.specificSurveyRelationIndex===e.specificSurveyRelationData.length-1:m=!0,g.isEntireSurveyCompleted=m,e.setIsSavingSurveyResponses(!0);try{await t.saveSurveyResponses({surveyData:g,administrationId:i}),window.localStorage.removeItem(`${S}-${n}`),c==="student"?e.setIsGeneralSurveyComplete(!0):e.isGeneralSurveyComplete?e.specificSurveyRelationIndex===e.specificSurveyRelationData.length-1&&e.setIsSpecificSurveyComplete(!0):e.setIsGeneralSurveyComplete(!0),e.setSpecificSurveyRelationIndex(e.specificSurveyRelationIndex+1),a.invalidateQueries({queryKey:["surveyResponses",n]}),l.requireHomeRefresh(),f.push({name:"Home"})}catch(p){e.setIsSavingSurveyResponses(!1),console.error(p),o.add({severity:"error",summary:"Error saving survey responses: "+(p instanceof Error?p.message:String(p)),life:3e3})}finally{e.setIsSavingSurveyResponses(!1)}}export{T as A,K as a,F as b,H as c,k as f,J as g,B as r,q as s};
//# sourceMappingURL=survey-CRadXOqO.js.map
