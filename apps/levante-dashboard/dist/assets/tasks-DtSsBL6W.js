import{cA as m,F as p,bo as b,aR as f,bl as d,bm as y,cB as h,aK as l,aG as Q,aS as D}from"./index-kdKfEdeI.js";import{g as I}from"./lodash-DAY8-RAI.js";import{a6 as _}from"./tanstack-CsBZeLmk.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},r=new e.Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="fc1cc91f-57bb-4c72-8123-d66305215428",e._sentryDebugIdIdentifier="sentry-dbid-fc1cc91f-57bb-4c72-8123-d66305215428")}catch{}})();var k=m;function q(e){return e&&e.length?k(e):[]}var B=q;const T=I(B),E=({registered:e=!0,allData:r=!1,orderBy:a,aggregationQuery:u,pageLimit:o,page:n,paginate:i=!1,select:c=["name"]})=>{const t={structuredQuery:{}};return a&&(t.structuredQuery.orderBy=a),i&&(t.structuredQuery.limit=o,t.structuredQuery.offset=n*o),r||(t.structuredQuery.select={fields:c.map(s=>({fieldPath:s}))}),t.structuredQuery.from=[{collectionId:"tasks",allDescendants:!1}],e&&(t.structuredQuery.where={fieldFilter:{field:{fieldPath:"registered"},op:"EQUAL",value:{booleanValue:!0}}}),t},S=async(e=!0,r=!1,a=["name","testData","demoData"])=>{const u=f(),o=E({registered:e,allData:r,aggregationQuery:!1,paginate:!1,select:r?"":a});return u.post(`${d()}:runQuery`,o).then(({data:n})=>y(n))},R=async e=>{const r=_(e).map(a=>({collection:p.TASKS,docId:a}));return b(r,h.ADMIN)},v=({registered:e=!1,aggregationQuery:r,pageLimit:a,page:u,paginate:o=!1})=>{const n={structuredQuery:{}};return o&&(n.structuredQuery.limit=a,n.structuredQuery.offset=u*a),n.structuredQuery.from=[{collectionId:"variants",allDescendants:!0}],e&&(n.structuredQuery.where={fieldFilter:{field:{fieldPath:"registered"},op:"EQUAL",value:{booleanValue:!0}}}),n},V=async(e=!1)=>{const r=f(),a=v({registered:e,aggregationQuery:!1,paginate:!1});return r.post(`${d()}:runQuery`,a).then(async({data:u})=>{const o=y(u,!0),n=T(l(u.map(t=>{var s;if((s=t.document)!=null&&s.name)return t.document.name.split("/variants/")[0]}),void 0)),c=(await r.post(`${d()}:batchGet`,{documents:n}).then(({data:t})=>l(t.map(({found:s})=>{if(s)return{name:s.name,data:{id:s.name.split("/tasks/")[1],...Q(s.fields,g=>D(g))}}}),void 0))).reduce((t,s)=>(t[s.data.id]={...s},t),{});return o.map(t=>{const s=c[t.parentDoc];return{id:t.id,variant:t,task:s.data}})}).catch(u=>(console.error(u),[]))};export{T as _,R as f,S as t,V as v};
//# sourceMappingURL=tasks-DtSsBL6W.js.map
